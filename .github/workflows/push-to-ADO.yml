name: Push to ADO

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  push-to-other-repo:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: filter out .github folder
        run: git filter-branch --force --index-filter "git rm --cached --ignore-unmatch .github*" --prune-empty --tag-name-filter cat -- --all

      - name: Push to Azure DevOps repository
        env:
          ADO_ORG: ${{ secrets.ADO_ORG }}
          ADO_PROJECT: ${{ secrets.ADO_PROJECT }}
          ADO_REPO: ${{ secrets.ADO_REPO }}
          ADO_BRANCH: ${{ secrets.ADO_BRANCH }}
          ADO_PAT: ${{ secrets.ADO_PAT }}
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "vpalomares@eshopworld.com"
          git remote add target https://${ADO_ORG}:${ADO_PAT}@dev.azure.com/${ADO_ORG}/${ADO_PROJECT}/_git/${ADO_REPO}
          git push --force target HEAD:${ADO_BRANCH}
