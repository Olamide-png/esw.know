---
title: APIS in the Cartridge
description: Authentication is essential to ensure secure and authorized access to ESW services.
icon: 'lucide:user-lock'
toc: false
---

## Authentication API

An Authentication API call is **required** before accessing any ESW APIs such as the:

- **Pricing Advisor API**{style="color: teal"} 
- **Checkout API,**{style="color: teal"}
- **Package API**{style="color: teal"}

### OAuth-Based Authentication

- The ESW cartridge uses OAuth 2.0 to authenticate API requests.

- You must first obtain an access token by making a request to the Authentication API.

- This token is then included in the authorization header of subsequent API calls.

Proper authentication is essential to ensure secure and authorized access to ESW services.

<br>

| :smart-icon{name="lucide:server" size=20 class="dark:text-white"} **Service Name** | :smart-icon{name="lucide:file-text" size=20 class="dark:text-white"} **Description** | :smart-icon{name="lucide:code" size=20 class="dark:text-white"} **Interface** | :smart-icon{name="lucide:clock" size=20 class="dark:text-white"} **SLA** | :smart-icon{name="lucide:info" size=20 class="dark:text-white"} **Notes** |
|---|---|---|---|---|
| **esw.auth** | HTTPS Interface in JSON format | REST JSON | <ul><li>**Timeout:** 30 sec</li><li>**Circuit Breaker:** 20 calls</li><li>**Interval:** 50 sec</li></ul> | The client ID and client secret must be a part of the service configuration. |

## Basic Authentication During Order Confirmation

The ESW-SFCC cartridge uses Basic Authentication when notifying SFCC about order confirmations.

### Sandbox Configuration

For Sandbox environments, you must pass two parameters:

- `OrderConfirmationUri_TestOnly` Specifies the SFCC Notify endpoint URL for the order confirmation callback.

- `OrderConfirmationBase64EncodedAuth_TestOnly`Contains the Base64-encoded credentials (username:password) for basic authentication.
If authentication is not enabled, this parameter should be set to `1`.

Both parameters are defined under the `metadataItems` property in the `retailerCheckoutExperience` object.

```json [Example]
{
"retailerCheckoutExperience": {
   "backToCartUrl":"https://dev1.demandware.net/on/demandware.store/Sites-RefArch-Site/en_US/Cart-Show",
   "continueShoppingUrl":"https://dev1.demandware.net/on/demandware.store/Sites-RefArch-Site/en_US/Home-Show",
   "metadataItems": [
        { 
        "Name":"OrderConfirmationUri_TestOnly",
        "Value":"https://dev1.demandware.net/on/demandware.store/Sites-RefArch-Site/en_US/EShopWorld-NotifyV2"
        },
        {
        "Name":"OrderConfirmationBase64EncodedAuth_TestOnly",
        "Value":"gasxdasFSAFASGAfasfas=="
        } 
    ]
  }
}
```

::alert{type="secondary" icon="lucide:lightbulb"}
  For the Production instance, you must save the username and password details provided by ESW under the ESW General Configuration custom preference group.
::


## Pricing Advisor

The ESW-SFCC cartridge uses the Pricing Advisor service to calculate localized product prices based on various country-specific and currency-based factors.

### Price Calculation Formula

The general formula used to calculate product prices is:<br>

```java
(((Product base price × (1 + priceUpliftPercentage)) × (1 + dutyPercentage)) × (1 + taxPercentage)) × fxRate = Price in shopper currency → apply rounding = Final product price
```

## Country Pricing Models

### Calculated Price Countries

For countries where calculated pricing is enabled:

- **Shopper pays in base currency**: Only country-specific adjustments are applied to the price from the price book.
- **Shopper pays in a different currency**: Both the FX rate and country adjustments are applied to the base price.

### Fixed Price Countries

For countries with fixed pricing: 

- **Shopper pays in base currency**: No calculation is performed; the price is used as-is from the price book.

### Additional Pricing Factors

Pricing calculations may also vary based on:

1. Currency exponent

2. Rounding direction

3. Rounding model


::card-group
  ::card
  ---
  to: /apis/pricing-advisor-api/pricing-advisor-concepts
  target: _blank
  # showLinkIcon: false
  icon: 'lucide:calculator'
  icon-size: 40
  horizontal: true
  ---

  #title
  More information on how the product prices are calculated.

  #description
  Full documentation on Pricing Advisor API, rounding direction, and model
  ::
::  



## Pricing Advisor API

To interact with the Pricing Advisor API, you must include a valid access token in the `Authorizationbearer` header of every request.

Note that an Authentication API call is required before a call is made to the Pricing Advisor API.

<br>

<div class="mt-2 bg-blue-100 border border-blue-200 text-sm text-blue-800 rounded-lg p-4 dark:bg-blue-800/10 dark:border-blue-900 dark:text-blue-500" role="alert" tabindex="-1" aria-labelledby="hs-soft-color-info-label">
  <span id="hs-soft-color-info-label" class="font-bold">Note</span> An Authentication API call is required before a call is made to the Pricing Advisor API.
</div>

### Authentication Request Parameters

```ini
grant_type = "client_credentials"
scope = "pricing.advisor.api.all"
```

### How Does It Work?

When the Pricing Feed Job is triggered from SFCC Business Manager, the following process takes place:

<!-- Stepper -->
<div data-stepper="" class="w-full">
  <!-- Stepper Nav -->
  <ul class="relative flex flex-row gap-x-2">
    <li class="group flex flex-1 shrink basis-0 items-center gap-x-2" data-stepper-nav-item='{ "index": 1 }'>
      <span class="min-h-7.5 min-w-7.5 inline-flex items-center align-middle text-sm">
        <span class="stepper-active:text-bg-primary stepper-active:shadow-sm shadow-base-300/20 stepper-success:text-bg-primary stepper-success:shadow-sm stepper-completed:text-bg-success text-bg-soft-neutral flex size-7.5 shrink-0 items-center justify-center rounded-full font-medium" >
          <span class="stepper-success:hidden stepper-completed:hidden">1</span>
          <span class="icon-[tabler--check] stepper-success:block hidden size-4 shrink-0"></span>
        </span>
        <span class="text-base-content ms-2 max-sm:hidden">Step</span>
      </span>
      <div class="stepper-success:bg-primary stepper-completed:bg-success bg-neutral/20 h-px w-full flex-1 group-last:hidden" ></div>
    </li>
    <li class="group flex flex-1 shrink basis-0 items-center gap-x-2" data-stepper-nav-item='{ "index": 2 }'>
      <span class="min-h-7.5 min-w-7.5 inline-flex items-center align-middle text-sm">
        <span class="stepper-active:text-bg-primary stepper-active:shadow-sm shadow-base-300/20 stepper-success:text-bg-primary stepper-success:shadow-sm stepper-completed:text-bg-success stepper-error:text-bg-error text-bg-soft-neutral flex size-7.5 shrink-0 items-center justify-center rounded-full font-medium" >
          <span class="stepper-success:hidden stepper-completed:hidden">2</span>
          <span class="icon-[tabler--check] stepper-success:block hidden size-4 shrink-0"></span>
        </span>
        <span class="text-base-content ms-2 max-sm:hidden">Step</span>
      </span>
      <div class="stepper-success:bg-primary stepper-completed:bg-success bg-neutral/20 h-px w-full flex-1 group-last:hidden" ></div>
    </li>
    <li class="group flex flex-1 shrink basis-0 items-center gap-x-2" data-stepper-nav-item='{ "index": 3 }'>
      <span class="min-h-7.5 min-w-7.5 inline-flex items-center align-middle text-sm">
        <span class="stepper-active:text-bg-primary stepper-active:shadow-sm shadow-base-300/20 stepper-success:text-bg-primary stepper-success:shadow-sm stepper-completed:text-bg-success stepper-error:text-bg-error text-bg-soft-neutral flex size-7.5 shrink-0 items-center justify-center rounded-full font-medium" >
          <span class="stepper-success:hidden stepper-completed:hidden">3</span>
          <span class="icon-[tabler--check] stepper-success:block hidden size-4 shrink-0"></span>
        </span>
        <span class="text-base-content ms-2 max-sm:hidden">Step</span>
      </span>
      <div class="stepper-success:bg-primary stepper-completed:bg-success bg-neutral/20 h-px w-full flex-1 group-last:hidden" ></div>
    </li>
    <!-- End Item -->
  </ul>
  <!-- End Stepper Nav -->

  <!-- Stepper Content -->
  <div class="mt-5 sm:mt-8">
    <!-- First Content -->
    <div data-stepper-content-item='{ "index": 1 }'>
      <div class="border-base-content/40 bg-base-200/50 flex h-48 items-center justify-center rounded-xl border border-dashed p-4" >
        <h3 class="text-base-content/50 text-2xl">First content</h3>
      </div>
    </div>
    <!-- End First Content -->
    <!-- Second Content -->
    <div data-stepper-content-item='{ "index": 2 }' style="display: none;">
      <div class="border-base-content/40 bg-base-200/50 flex h-48 items-center justify-center rounded-xl border border-dashed p-4" >
        <h3 class="text-base-content/50 text-2xl">Second content</h3>
      </div>
    </div>
    <!-- End Second Content -->
    <!-- Third Content -->
    <div data-stepper-content-item='{ "index": 3 }' style="display: none;">
      <div class="border-base-content/40 bg-base-200/50 flex h-48 items-center justify-center rounded-xl border border-dashed p-4" >
        <h3 class="text-base-content/50 text-2xl">Third content</h3>
      </div>
    </div>
    <!-- End Third Content -->
    <!-- Final Content -->
    <div data-stepper-content-item='{ "isFinal": true }' style="display: none;">
      <div class="border-base-content/40 bg-base-200/50 flex h-48 items-center justify-center rounded-xl border border-dashed p-4" >
        <h3 class="text-base-content/50 text-2xl">Final content</h3>
      </div>
    </div>
    <!-- End Final Content -->
    <!-- Button Group -->
    <div class="mt-5 flex items-center justify-between gap-x-2">
      <button type="button" class="btn btn-primary" data-stepper-back-btn="">
        <span class="icon-[tabler--chevron-left] text-primary-content rtl:rotate-180"></span>
        Back
      </button>
      <button type="button" class="btn btn-primary" data-stepper-next-btn="">
        Next
        <span class="icon-[tabler--chevron-right] text-primary-content rtl:rotate-180"></span>
      </button>
      <button type="button" class="btn btn-primary" data-stepper-finish-btn="" style="display: none;"> Finish </button>
      <button type="reset" class="btn btn-primary" data-stepper-reset-btn="" style="display: none;"> Reset </button>
    </div>
    <!-- End Button Group -->
  </div>
  <!-- End Stepper Content -->
</div>
<!-- End Stepper -->


| :smart-icon{name="lucide:server" size=20 class="dark:text-white"} **Service Name** | :smart-icon{name="lucide:file-text" size=20 class="dark:text-white"} **Description** | :smart-icon{name="lucide:code" size=20 class="dark:text-white"} **Interface** | :smart-icon{name="lucide:clock" size=20 class="dark:text-white"} **SLA** | :smart-icon{name="lucide:info" size=20 class="dark:text-white"} **Notes** |
|---|---|---|---|---|
| **EswPriceFeedV3Service** | HTTPS Interface in JSON format | REST JSON | <ul><li>**Timeout:** 30 sec</li><li>**Circuit Breaker:** 20 calls</li><li>**Interval:** 50 sec</li></ul> |  |

### Pricing Advisor API – Request/Response Schema

#### API Call Type
- Protocol: REST HTTPS
- Swagger Documentation ::button-link{left-icon="lucide:terminal" variant="ghost" href="https://know.esw.com/page/pricing-advisor-api" blank}
  Pricing Advisor API Swagger
::

##### Request
Method: **GET**{style="color: cornflowerblue"}

Request Body: None

Authentication: Requires `Bearer` token in the `Authorization` header

```json [Sample Response] height=150 collapse
{
  "fxRates": [
    {
      "fromRetailerCurrencyIso": "EUR",
      "toShopperCurrencyIso": "USD",
      "rate": "1.05"
    }
  ],
  "deliveryCountryAdjustments": [
    {
      "deliveryCountryIso": "GB",
      "retailerAdjustments": {
        "priceUpliftPercentage": 12.5
      },
      "estimatedRates": {
        "dutyPercentage": 18,
        "taxPercentage": 22
      }
    }
  ],
  "deliveryCountryCurrencyDisplays": [
    {
      "deliveryCountryIso": "GB",
      "currencyDisplays": [
        {
          "currencyIso": "USD",
          "currencyExponent": 2,
          "currencySymbol": "€",
          "showTrailingZeros": true,
          "thousandSeparator": ",",
          "decimalSeparator": ".",
          "configurationString": "[Number][ExponentSeparator][Exponent] [CurrencyISO]"
        }
      ]
    }
  ],
  "deliveryCountryRoundingModels": [
    {
      "deliveryCountryIso": "GB",
      "roundingModels": [
        {
          "currencyIso": "EUR",
          "currencyExponent": 2,
          "direction": "Up",
          "model": "none.fixed50"
        }
      ]
    }
  ],
  "lastUpdated": "1994-11-05T13:15:30Z",
  "pricingSynchronizationId": "f5ac11b9-cbc6-4ba2-932f-7bf207b3ed61"
}
```


## ESW Checkout
The ESW Checkout page is displayed when shoppers click the Checkout button on the retailer’s SFCC storefront. It provides a seamless, localized checkout experience with the following features.

### Key Features

1. Navigation URLs
 - Continue Shopping and Back to Cart links are provided directly on the ESW Checkout page.
 - Clicking these links redirects the shopper back to the SFCC storefront.

2. Price Display: The checkout page clearly displays:

- Product unit prices

- Shipping costs

### Checkout API

To interact with the Checkout API, all requests must be properly authenticated using an access token.

#### Authentication Request Parameters
To retrieve the token, use the following parameters in your Authentication API request:

```ini
grant_type = "client_credentials"
scope = "checkout.preorder.api.all"
```

