---
title: SiteGenesis
description: Customizing the ESW integration in SiteGenesis
icon: 'lucide:wrench'
toc: false
navigation: true
---

## Customizing the code

When customizing the ESW integration in SiteGenesis, you must ensure changes are applied to the correct cartridge and file paths. Below is an example for customizing storefront templates

### Templates

::tabs{variant="line"}
  ::div{label="header.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/components/header/header.isml`

  ### Description
  Loads ESW landing page, ESW header, app resources, and loader based on ESW module status and preferences.

  ```html icon-park-outline:source-code
  <isset name="eswHelper" value="${require('*/cartridge/scripts/helper/eswHelper').getEswHelper()}" scope="page"/>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled() && eswHelper.getEnableLandingPage() && request.httpParameterMap.get(dw.system.Site.current.preferences.custom.eswCountryUrlParam) == false}">
    <isinclude url="${URLUtils.url('EShopWorld-GetEswLandingPage', dw.system.Site.current.getCustomPreferenceValue('eswCountryUrlParam'),pdict.CurrentHttpParameterMap.get(dw.system.Site.current.getCustomPreferenceValue('eswCountryUrlParam')))}"/>
  </isif>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}">
    <isinclude url="${URLUtils.url('EShopWorld-GetEswHeader', 'pageContextType', pageContext.type, dw.system.Site.current.getCustomPreferenceValue('eswCountryUrlParam'), pdict.CurrentHttpParameterMap.get(dw.system.Site.current.getCustomPreferenceValue('eswCountryUrlParam')))}"/>
  </isif>
  <isif condition="${eswHelper.getEShopWorldModuleEnabled() && eswHelper.isFrontendConversionEnabled()}">
    <isinclude url="${URLUtils.url('EShopWorld-GetEswAppResources', dw.system.Site.current.getCustomPreferenceValue('eswCountryUrlParam'),pdict.CurrentHttpParameterMap.get(dw.system.Site.current.getCustomPreferenceValue('eswCountryUrlParam')))}"/>
  </isif>
  <isif condition="${eswHelper.getEShopWorldModuleEnabled() && eswHelper.isESWSupportedCountry()}">
    <i class="eshopworld-loader d-none"></i>
  </isif>
  ```
  ::

  ::div{label="footer.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/components/footer/footer.isml`

  ### Description
  Loads ESW footer content if the ESW module is active.

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}">
    <isinclude url="${URLUtils.url('EShopWorld-GetEswFooter', 'pageContextType', pageContext.type, dw.system.Site.current.getCustomPreferenceValue('eswCountryUrlParam'), pdict.CurrentHttpParameterMap.get(dw.system.Site.current.getCustomPreferenceValue('eswCountryUrlParam')))}"/>
  </isif>
  ```
  ::

  ::div{label="footer_UI.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/components/footer/footer_UI.isml`

  ### Description
  Injects ESW frontend scripts and styles.

  ```html
  <script defer type="text/javascript" src="${URLUtils.staticURL('/js/EswHooks.js')}"></script>
  <link rel="stylesheet" href="${URLUtils.staticURL('/css/EswCss.css')}" />
  ```
  ::
  
  ::div{label="cart.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/checkout/cart/cart.isml`

  ### Description
  Controls checkout button rendering, ESW validation messages, and converted pricing display.  
  Use the `EShopWorld-GetConvertedPrice` controller to convert prices.

  ```html
  <button id="btnCheckout" class="button-fancy-large<isif condition="${eswHelper.getEShopWorldModuleEnabled() && eswHelper.isESWSupportedCountry()}"> btnCheckout</isif>" type="submit" value="${Resource.msg('global.checkout','locale',null)}" name="${pdict.CurrentForms.cart.checkoutCart.htmlName}">
  ```
  
  ```html
  <button id="btnCheckout" class="button-fancy-large<isif condition="${eswHelper.getEShopWorldModuleEnabled() && eswHelper.isESWSupportedCountry()}"> btnCheckout</isif>" disabled="disabled" type="submit" value="${Resource.msg('global.checkout','locale',null)}" name="${pdict.CurrentForms.cart.checkoutCart.htmlName}">
  ```

  ```html
  <iselseif condition="${pdict.BasketStatus.code != null && pdict.BasketStatus.code=='EswError'}">
    ${Resource.msg('cart.eswerror','esw',null)}
  <iselseif condition="${pdict.BasketStatus.code != null && pdict.BasketStatus.code=='EswProductRestrictedError'}">
    ${Resource.msg('cart.esw.product.notavailable','esw',null)}
  <iselse/>
  </isif>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}"> 
    <span class="price-standard"><isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', StandardPrice, 'noAdjustment', false)}"/></span>
    <span class="price-sales"><isprint value="${eswHelper.getSubtotalObject(lineItem, false, false, true)}" /></span>
  <iselse>
    <span class="price-standard"><isprint value="${StandardPrice}" /></span>
    <span class="price-sales"><isprint value="${SalesPrice}" /></span>
  </isif>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}"> 
    <isprint value="${eswHelper.getSubtotalObject(lineItem, false, false, true)}" />
  <iselse>
    <isprint value="${SalesPrice}" />
  </isif>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}">
    <isprint value="${eswHelper.getSubtotalObject(lineItem,false, true)}" />
  <iselse>
    <isprint value="${lineItem.getPrice()}" />
  </isif>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}">
    <isprint value="${eswHelper.getSubtotalObject(lineItem,false)}" />
  <iselse>
    <isprint value="${lineItem.getAdjustedPrice()}" />
  </isif>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}">
    <isprint value="${eswHelper.getSubtotalObject(lineItem,false)}" />
  <iselse>
    <isprint value="${lineItem.getAdjustedPrice()}" />
  </isif>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}">
    <span class="price-standard"><isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', StandardPrice, 'noAdjustment', false)}"/></span>
    <span class="price-sales"><isprint value="${eswHelper.getSubtotalObject(lineItem, false, false, true)}" /></span>
  <iselse>
    <span class="price-standard"><isprint value="${StandardPrice}" /></span>
    <span class="price-sales"><isprint value="${bonusProductPrice}"/></span>
  </isif>
  ```

  ```html
  <button class="button-fancy-large<isif condition="${eswHelper.getEShopWorldModuleEnabled() && eswHelper.isESWSupportedCountry()}"> btnCheckout</isif>" type="submit" value="${Resource.msg('global.checkout','locale',null)}" name="${pdict.CurrentForms.cart.checkoutCart.htmlName}">
    ${Resource.msg('global.checkout','locale',null)}
  </button>

  <button class="button-fancy-large<isif condition="${eswHelper.getEShopWorldModuleEnabled() && eswHelper.isESWSupportedCountry()}"> btnCheckout</isif>" disabled="disabled" type="submit" value="${Resource.msg('global.checkout','locale',null)}" name="${pdict.CurrentForms.cart.checkoutCart.htmlName}">
    ${Resource.msg('global.checkout','locale',null)}
  </button>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled() && eswHelper.isESWSupportedCountry()}">
    <iscontentasset aid="esw-checkout-disclaimer-message" />
  </isif>
  ```
  ::
  
  ::div{label="minicart.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/checkout/cart/minicart.isml`

  ### Description
  Displays subtotal and checkout link, with logic for ESW subtotal and disclaimer message.  
  `eswHelper.getSubtotalObject(pdict.Basket, true)` calculates order totals using ESW FX and adjustments.  
  The `btnCheckout` class redirects to ESW Checkout when enabled and supported.

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}">
    <isprint value="${eswHelper.getSubtotalObject(pdict.Basket,true)}"/>
  <iselse>
    <isprint value="${pdict.Basket.getAdjustedMerchandizeTotalPrice(false).add(pdict.Basket.giftCertificateTotalPrice)}"/>
  </isif>
  ```

  ```html
  <a class="mini-cart-link-checkout<isif condition="${eswHelper.getEShopWorldModuleEnabled() && eswHelper.isESWSupportedCountry()}"> btnCheckout</isif>" href="${URLUtils.https('COCustomer-Start')}" title="${Resource.msg('minicart.directcheckout','checkout',null)}">
    ${Resource.msg('minicart.directcheckout','checkout',null)} &raquo;
  </a>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled() && eswHelper.isESWSupportedCountry()}">
    <iscontentasset aid="esw-checkout-disclaimer-message" />
  </isif>
  ```
  ::

  ::div{label="orderdetails.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/components/order/orderdetails.isml`

  ### Description
  Renders ESW payment values and tracking information per order context.

  ```rb
  <isscript>
    var eswHelper = require('*/cartridge/scripts/helper/eswHelper').getEswHelper();
    var formatMoney = require('dw/util/StringUtils').formatMoney;
    var eswOrderHistoryFlag = false;
    var eswModuleEnabled = eswHelper.getEShopWorldModuleEnabled();
    var isEswSupportedCountry = eswHelper.isESWSupportedCountry();
    if (eswModuleEnabled) {
      eswOrderHistoryFlag = eswHelper.isEswOrderHistory(Order);
    }
  </isscript>
  ```

  ```html
  <isif condition="${eswModuleEnabled && eswOrderHistoryFlag && !empty(Order.custom.eswShopperCurrencyCode)}">
    <isprint value="${dw.value.Money(Order.custom.eswShopperCurrencyPaymentAmount,Order.custom.eswShopperCurrencyCode)}"/>
  <iselseif condition="${eswModuleEnabled && isEswSupportedCountry && !eswOrderHistoryFlag && empty(Order.custom.eswShopperCurrencyCode)}">
    <isprint value="${paymentInstr.paymentTransaction.custom.eswPaymentAmount}"/>
  <iselse>
    <isprint value="${paymentInstr.paymentTransaction.amount}"/>
  </isif>
  ```

  ```html
  <isif condition="${!empty(Order.custom.eswPackageReference)}">
    <isset name="eswTrackingUrl" value="${!empty(dw.system.Site.current.preferences.custom.eswTrackingUrl) ? dw.system.Site.current.preferences.custom.eswTrackingUrl + Order.custom.eswPackageReference : '#'}" scope="page" />
    <div class="trackingnumber">
      <div class="label">${Resource.msg('order.orderdetails.tracking','order',null)}</div>
      <div class="value">
        <a target="_blank" href="${eswTrackingUrl}"><isprint value="${Order.custom.eswPackageReference}"/></a>
      </div>
    </div>
  </isif>
  <iselse>
    <isif condition="${!empty(shipment.trackingNumber)}">
      <div class="trackingnumber">
        <div class="label">${Resource.msg('order.orderdetails.tracking','order',null)}</div>
        <div class="value"><isprint value="${shipment.trackingNumber}"/></div>
      </div>
    </isif>
  </isif>
  ```

  ```html
  <isif condition="${eswOrderHistoryFlag && !empty(Order.custom.eswShopperCurrencyCode)}">
    <isscript>
      var price = new Number((productLineItem.custom.eswShopperCurrencyItemPriceInfo * productLineItem.quantityValue));
      var formatedPrice = formatMoney(new dw.value.Money(price, Order.custom.eswShopperCurrencyCode));
    </isscript>
    <div class="value">${formatedPrice}</div>
  <iselse/>
  ```
  ::

  ::div{label="ordertotals.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/components/order/ordertotals.isml`

  ### Description
  Displays ESW subtotal, shipping, discount, tax, and totals using ESW pricing logic.

  ```rb
  <isscript>
    var eswHelper = require('*/cartridge/scripts/helper/eswHelper').getEswHelper();
    var eswOrderHistoryFlag = false;
    var eswModuleEnabled = eswHelper.getEShopWorldModuleEnabled();
    var isEswSupportedCountry = eswHelper.isESWSupportedCountry();
    if (eswModuleEnabled) {
      eswOrderHistoryFlag = eswHelper.isEswOrderHistory(LineItemCtnr);
      var getOrderTotals = require('*/cartridge/scripts/helper/orderHistoryTotals').orderTotals;
    }
  </isscript>
  ```

  ```html
  <isif condition="${eswModuleEnabled && eswOrderHistoryFlag}">
    <td><isprint value="${getOrderTotals(LineItemCtnr).subTotal}" /></td>
  <iselseif condition="${eswModuleEnabled && isEswSupportedCountry && !eswOrderHistoryFlag}">
    <td><isprint value="${eswHelper.getSubtotalObject(LineItemCtnr,true)}" /></td>
  <iselse>
    <td><isprint value="${LineItemCtnr.getAdjustedMerchandizeTotalPrice(false).add(LineItemCtnr.giftCertificateTotalPrice)}"/></td>
  </isif>
  ```

  ```html
  <isif condition="${!empty(orderDiscount) && orderDiscount.value > 0.0}">
    <tr class="order-discount discount">
      <td>${Resource.msg('order.ordersummary.orderdiscount','order',null)}</td>
      <td> - <isprint value="${(eswModuleEnabled) ? eswHelper.getOrderDiscount(LineItemCtnr) : orderDiscount }" /></td>
    </tr>
  </isif>
  <iscomment>render each single shipment or shipping total</iscomment>
  <isif condition="${!eswModuleEnabled || !isEswSupportedCountry || eswOrderHistoryFlag}">
  ```

  ```html
  <isif condition="${eswModuleEnabled && eswOrderHistoryFlag}">
    <isprint value="${getOrderTotals(LineItemCtnr).totalShippingCost}"/>
  <iselseif condition="${eswModuleEnabled && isEswSupportedCountry && !eswOrderHistoryFlag}">
    <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', LineItemCtnr.shippingTotalPrice)}"/>
  <iselse>
    <isprint value="${LineItemCtnr.shippingTotalPrice}"/>
  </isif>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}">
    <td>- <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', shippingDiscount, 'noAdjustment', false)}"/></td>
  <iselse>
    <td>- <isprint value="${shippingDiscount}"/></td>
  </isif>
  ```

  ```html
  <isif condition="${eswModuleEnabled}">
    <td>- <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', shippingDiscount)}"/></td>
  <iselse>
    <td>- <isprint value="${shippingDiscount}"/></td>
  </isif>
  ```

  ```html
  <isif condition="${eswModuleEnabled && eswOrderHistoryFlag}">
    <isprint value="${getOrderTotals(LineItemCtnr).totalTax}"/>
  <iselseif condition="${eswModuleEnabled && isEswSupportedCountry && !eswOrderHistoryFlag}">
    <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', LineItemCtnr.totalTax, 'noAdjustment', false)}"/>
  <iselse>
    <isprint value="${LineItemCtnr.totalTax}"/>
  </isif>
  ```

  ```html
  <isif condition="${eswModuleEnabled && eswOrderHistoryFlag}">
    <isprint value="${getOrderTotals(LineItemCtnr).grandTotal}"/>
  <iselseif condition="${eswModuleEnabled && isEswSupportedCountry && !eswOrderHistoryFlag}">
    <isprint value="${eswHelper.getFinalOrderTotalsObject()}"/>
  <iselse>
    <isprint value="${orderTotalValue}"/>
  </isif>
  ```
  ::
  
  ::div{label="minilineitems.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/checkout/components/minilineitems.isml`

  ### Description
  Renders converted price for a single mini-cart line item.

  ```html
  <span class="mini-cart-price">
    <isprint value="${eswHelper.getSubtotalObject(productLineItem)}"/>
  </span>
  ```
  ::

  ::div{label="pricing.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/product/components/pricing.isml`

  ### Description
  Price display component with ESW conversions and ranges.

  ```rb
  <isscript>  
    var eswHelper = require('*/cartridge/scripts/helper/eswHelper').getEswHelper();
    // for variation groups use the master, because all variants are available in detail page
    if (pdict.Product && pdict.Product.variationGroup) {
      pdict.Product = pdict.Product.masterProduct;
    }
  </isscript>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}">
    <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', pdict.ProductSetSalesPrice, 'noAdjustment', false)}"/>
  <iselse>
    <isprint value="${dw.util.StringUtils.formatMoney(dw.value.Money(pdict.ProductSetSalesPrice, pdict.CurrencyCode))}" />
  </isif>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}">
    <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', pdict.Product.priceModel.minPrice, 'noAdjustment', false)}"/> - 
    <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', pdict.Product.priceModel.maxPrice)}"/>
  <iselse>
    <isprint value="${pdict.Product.priceModel.minPrice}"/> - <isprint value="${pdict.Product.priceModel.maxPrice}"/>
  </isif>
  ```

  ```html
  <isif condition="${StandardPrice.valueOrNull != null && StandardPrice.valueOrNull > 0}">
    <isif condition="${eswHelper.getEShopWorldModuleEnabled()}"> 
      <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', StandardPrice)}"/>
    <iselse>
      <isprint value="${StandardPrice}"/>
    </isif>
  <iselse/>
    ${Resource.msg('product.pricing.noprice','product',null)}
  </isif>
  ```

  ```html
  <isif condition="${eswHelper.getEShopWorldModuleEnabled()}"> 
    <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', SalesPrice)}"/>
  <iselse>
    <isprint value="${SalesPrice}"/>
  </isif>
  ```
  ::

  ::div{label="producttile.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/product/producttile.isml`

  ### Description
  Tile pricing with ESW range handling and restriction checks.

  ```rb
  <isscript>
    var eswHelper = require('*/cartridge/scripts/helper/eswHelper').getEswHelper();
  </isscript>
  ```

  ```html
  <isif condition="${showpricing && !eswHelper.isProductRestricted(Product)}">
  ```

  ```js
  if (eswHelper.getEShopWorldModuleEnabled()) {
    price.value = dw.value.Money(pdict.CurrentHttpParameterMap.minprice, currencyCode) + ' - ' + dw.value.Money(pdict.CurrentHttpParameterMap.maxprice, currencyCode);
  } else {
    price.value = dw.util.StringUtils.formatMoney(dw.value.Money(pdict.CurrentHttpParameterMap.minprice, currencyCode)) + ' - ' + dw.util.StringUtils.formatMoney(dw.value.Money(pdict.CurrentHttpParameterMap.maxprice, currencyCode));
  }
  ```

  ```html
  <isif condition="${(!empty(productPrice.value) && typeof productPrice.value !== 'string' && eswHelper.getEShopWorldModuleEnabled())}">
    <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', productPrice.value, 'noAdjustment', false)}"/>
  <iselseif condition="${(typeof productPrice.value == 'string' && !Product.productSet && eswHelper.getEShopWorldModuleEnabled())}">
    <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', productPrice.value, 'noAdjustment', false, 'ranged', true)}"/>
  <iselse>
    <isprint value="${productPrice.value}"/>
  </isif>
  ```
  ::

  ::div{label="productsearchbreadcrumbs.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/search/components/productsearchbreadcrumbs.isml`

  ### Description
  Price range breadcrumb using ESW money object.

  ```js
  breadcrumbLabel = eswHelper.getMoneyObject(prdValues.iterator().next().valueFrom) + ' - ' + eswHelper.getMoneyObject(prdValues.iterator().next().valueTo);
  ```
  ::

  ::div{label="productsearchrefinebar.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/search/components/productsearchrefinebar.isml`

  ### Description
  Price refinement links with converted ranges.

  ```html
  <a class="refinement-link" title="${Resource.msg('global.remove','locale',null)} ${RefinementValue.getDisplayValue()}" href="${StringHelpers.unsanitizeOR(pdict.ProductSearchResult.urlRelaxPrice('Search-Show'))}">
    <i class="fa fa-check-square-o fa-lg"></i>
    <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', RefinementValue.valueFrom)}"/> - <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', RefinementValue.valueTo)}"/>
  </a>
  ```

  ```html
  <a class="refinement-link" title="${Resource.msg('global.pricerefinement.label.prefix','locale',null)} ${RefinementValue.getDisplayValue()}" href="${StringHelpers.unsanitizeOR(pdict.ProductSearchResult.urlRefinePrice('Search-Show',RefinementValue.getValueFrom(),RefinementValue.getValueTo()))}">
    <i class="fa fa-square-o fa-lg"></i>
    <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', RefinementValue.valueFrom)}"/> - <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', RefinementValue.valueTo)}"/>
  </a>
  ```
  ::

  ::div{label="suggestions.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/search/suggestions.isml`

  ### Description
  Autocomplete “from” price with conversion.

  ```html
  <div class="product-price">
    ${Resource.msg('search.suggest.from','search',null)} 
    <isinclude url="${URLUtils.url('EShopWorld-GetConvertedPrice', 'price', productSearchHit.getMinPrice())}"/>
  </div>
  ```
  ::

  ::div{label="productcontent.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/product/productcontent.isml`

  ### Description
  Product content with restriction & return-prohibited messaging.

  ```html
  <isset name="eswHelper" value="${require('*/cartridge/scripts/helper/eswHelper').getEswHelper()}" scope="page"/>
  ```

  ```html
  <isif condition="${!eswHelper.isProductRestricted(product)}">
    <isset name="showTieredPrice" value="${true}" scope="page"/>
    <isinclude template="product/components/pricing"/>
  </isif>
  ```

  ```html
  <isif condition="${eswHelper.isReturnProhibited(product)}">
    <iscontentasset aid="esw-display-return-prohibited-message"/>
  </isif>
  ```

  ```html
  <isif condition="${!eswHelper.isProductRestricted(product)}">
    <button id="add-to-cart" type="submit" title="${buttonTitle}" value="${buttonTitle}" class="button-fancy-large add-to-cart">${buttonTitle}</button>
    <isapplepay sku="${pdict.Product.ID}"></isapplepay>
  <iselse>
    ${Resource.msg('esw.product.notavailable','esw',null)}
  </isif>
  ```

  ```html
  <isif condition="${!eswHelper.isProductRestricted(product)}">
    <button id="add-to-cart" type="button" title="${buttonTitleDisabledSelectVariation}" value="${buttonTitleDisabledSelectVariation}" class="button-fancy-large add-to-cart-disabled"<isprint value="${disabledAttr}" encoding="off"/>>${buttonTitle}</button>
  <iselse>
    ${Resource.msg('esw.product.notavailable','esw',null)}
  </isif>
  ```
  ::

  ::div{label="producttopcontentPS.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/product/producttopcontentPS.isml`

  ### Description
  Top content for product sets with ESW restriction messaging.

  ```html
  <isinclude template="util/modules"/>
  <isset name="eswHelper" value="${require('*/cartridge/scripts/helper/eswHelper').getEswHelper()}" scope="page"/>
  ```

  ```html
  <isif condition="${eswHelper.isReturnProhibited(pdict.Product)}">
    <iscontentasset aid="esw-display-return-prohibited-message"/>
  </isif>
  ```

  ```html
  <isif condition="${!eswHelper.isProductRestricted(psProduct)}">
  <iselse>
    ${Resource.msg('esw.product.notavailable','esw',null)}
  </isif>
  ```
  ::

  ::div{label="productsetproduct.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/product/components/productsetproduct.isml`

  ### Description
  Pricing inclusion for items within a product set.

  ```html
  <isset name="eswHelper" value="${require('*/cartridge/scripts/helper/eswHelper').getEswHelper()}" scope="page"/>
  <isif condition="${!eswHelper.isProductRestricted(pdict.Product)}">
    <isinclude template="product/components/pricing"/>
  </isif>
  ```
  ::

  ::div{label="displayliproduct.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/product/components/displayliproduct.isml`

  ### Description
  Cart line item “not available” message on restriction.

  ```html
  <isif condition="${pdict.BasketStatus.code != null && pdict.BasketStatus.code=='EswProductRestrictedError' && productLineItem.productID == session.privacy.restrictedProductID}">
    <div class="product-not-available-msg-cart">
      ${Resource.msg('esw.product.notavailable','esw',null)}
    </div>
  </isif>
  ```
  ::

  ::div{label="orders.isml"}
  ### File Path
  `SiteGenesis_core/cartridge/templates/default/account/orderhistory/orders.isml`

  ### Description
  Display order totals in ESW shopper currency when available.

  ```html
  <isset name="eswHelper" value="${require('*/cartridge/scripts/helper/eswHelper').getEswHelper()}" scope="page"/>
  <span class="value">
    <isprint value="${(eswHelper.getEShopWorldModuleEnabled() && !empty(order.object.custom.eswShopperCurrencyPaymentAmount)) ? dw.value.Money(order.object.custom.eswShopperCurrencyPaymentAmount,order.object.custom.eswShopperCurrencyCode) : order.object.totalGrossPrice}"/>
  </span>
  ```
  ::
::





### Controllers

::tabs{variant="line"}
  ::div{label="controllers/Currency.js"}
  ### File Path
  `SiteGenesis_controllers/cartridge/controllers/Currency.js`

  ### Description
  Returns whether a selected country is ESW-allowed and echoes language/currency from cookies; exports web-exposed methods.

  ```js
  // …your full Currency.js snippet here…
  ```
  ::

  ::div{label="Cart.js"}
  ### File Path
  `SiteGenesis_controllers/cartridge/controllers/Cart.js`

  ### Description
  Renders the cart; when ESW is enabled and supported, applies ESW shipping method, recalculates, and adjusts threshold discounts.

  ```js
  // …your full Cart.js snippet here…
  ```
  ::

  ::div{label="COCustomer.js"}
  ### File Path
  `SiteGenesis_controllers/cartridge/controllers/COCustomer.js`

  ### Description
  Login form handler; routes unregistered checkout to ESW Pre-Order when module is enabled and country is allowed.

  ```js
  // …your full COCustomer.js snippet here…
  ```
  ::
::
<!-- ↑ final tabs closer must be flush-left; keep a blank line after it -->

### Scripts and JSON

::tabs{variant="line"}
  ::div{label="scripts/Resource.ds"}
  ### File Path
  `SiteGenesis_core/cartridge/scripts/util/Resource.ds`

  ### Description
  Key URL selectors used by ESW flows.

  ```js
  Selectors : URLUtils.url('Currency-SetSessionCurrency').toString(),
  preparePreOrderRequest : URLUtils.url('EShopWorld-PreOrderRequest').toString(),
  getAllowedCountry : URLUtils.url('Currency-GetAllowedCountry').toString(),
  getDefaultCurrency: URLUtils.url('EShopWorld-GetDefaultCurrency').toString(),
  getEswLandingPage : URLUtils.url('EShopWorld-GetEswLandingPage').toString()
  ```
  ::

  ::div{label="scripts/request/OnRequest.js"}
  ### File Path
  `SiteGenesis_controllers/cartridge/scripts/request/OnRequest.js`

  ### Description
  Global `onRequest` hook to handle ESW redirects and locale syncing.

  ```js
  // …your full OnRequest.js snippet here…
  ```
  #### ISML helper include (place at top of your `.isml`):
  ```js
  var eswHelper = require('int_eshopworld_controllers/cartridge/scripts/helper/eswHelper').getEswHelper();
  ```
  ::

  ::div{label="scripts/cart/ValidateCartForCheckout.js"}
  ### File Path
  `SiteGenesis_core/cartridge/scripts/cart/ValidateCartForCheckout.js`

  ### Description
  Sets `pdict.BasketStatus` on ESW error or restricted-product error.

  ```js
  // …your snippet…
  ```
  ::

  ::div{label="helper · GetMoneyObject"}
  ### Name
  `GetMoneyObject(price, noAdjustment, formatted, noRounding)`

  ### Description
  Helper used wherever prices are calculated or displayed…

  ::
  
  ::div{label="scripts/cart/calculate.js"}
  ### File Path
  `SG_core/cartridge/scripts/cart/calculate.js`

  ### Description
  During ESW order calculation, avoid applying platform promotions.

  ```js
  // …your snippet…
  ```
  ::

  ::div{label="scripts/hooks.json"}
  ### File Path
  `SG_core/cartridge/scripts/hooks.json`

  ### Description
  Override deprecated basket calculate hook to `dw.order.calculate`.

  ::
::





